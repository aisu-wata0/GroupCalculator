<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Redes 2</title>
    <link href="./cssfiles/bootstrap.min.css" rel="stylesheet">
    <link href="./cssfiles/docs.min.css" rel="stylesheet">

<body class="container">
<section class="row flex-nowrap">

        <main class="col-8 col-md-9 col-xl-10 py-md-3 pl-md-5 pl-5 bd-content" role="main">
            <h1 class="bd-title" id="content">Redes 2 - Trabalho</h1>
            <p class="bd-lead">Bernardo Ferrari<br>Bruno Serbena</p>

            <p>O trabalho de Redes 2 desse semestre consistiu na implementação de uma calculadora remota altamente-disponível, baseada
                em um grupo multicacast de N servidores.
            </p>
            <p>
                Para isso, a partir do arquivo servers.txt, que contém uma lista com o nome local e o número da porta de
                cada servidor possível que queremos conectar, cada servidor tenta se conectar com todos os endereços da
                lista em busca de outros servidores. Se encontrar, verifica qual possui o menor identificador. O servidor que,
                ao realizar essa busca, perceber que nenhum outro servidor conectado tem endereço menor que o dele, será
                marcado/promovido a líder, que será quem responde a todas as requisições do cliente.
            </p>
            <p>
                Fizemos o trabalho em <strong>TCP e UDP</strong>. O server.py roda os dois ao mesmo tempo! No caso do TCP,
                ele tenta conectar de um em um. No caso do UDP, ele faz uso do multicast para enviar de uma vez para o grupo.
            </p>
            <p>
                Em um terminal separado, temos o cliente se conectando. O usuário digita a expressão matemática desejada,
                como 1+1, e o cliente tenta criar uma conexão com cada cada servidor, usando <a href="https://docs.python.org/3/library/socket.html">socket</a>, e enviando a requisição caso consiga.

                Feito isso, o cliente usa a biblioteca nativa <a href="https://docs.python.org/3/library/select.html">select</a>
                para escutar por todos os servidores. O servidor de menor identificação (líder) efetua a operação matemática
                e retorna o resultado da conta.
            </p>
                <p>Para efetuar o cálculo da expressão matemática e poder devolver o resultado esperado (ou erro, em caso de divisão por zero,
                    ou expressão inválida), decidimos por usar a biblioteca <a href="https://pypi.org/project/pyparsing/">PyParsing</a>, disponível em
                código aberto, que permite transformar um texto em uma gramática simples. A partir disso, usamos um grupo de funções que transformam
                    em uma operação matemática e a resolve. É uma forma muito mais segura e, em muitos casos, mais rápida, e mais customizável que o uso do tradicional Eval.
                    É possível, portanto, efetuar as operações de soma (+), subtração (-), divisião (/), multiplicação (*), exponenciação (^),
                    seno (sin), cosseno (cos), tangente (tan), módulo (abs), concatenação (trunc) e aproximação (round).
            </p>
            <p>
                Caso o servidor líder, por qualquer motivo, não retorne o resultado da operação, irá ocorrer o Timeout, implementado
                no próprio <a href="https://docs.python.org/3/library/select.html">select</a>, que fará o cliente mostrar uma mensagem de erro,
                fechar todas as conexões abertas e pedir para o usuário proceder com outra operação matemática. Existem duas mensagens de erro:
                "zero-division" e "exception". A primeira é provocada por uma divisão por zero, e a segunda pela sintaxe estar errada. Usar, por exemplo,
                o valor "www" como entrada produz esse erro, já que não é uma expressão matemática. O cliente, ao receber essas mensagens, que irá
                mostrar a mensagem de erro completa. Fizemos assim pensando em um menor tráfego na rede e na eventual possiblidade de múltiplos idiomas, como a mensagem é a mesma
                e não depende do idioma, cada um poderia mostrar o erro no próprio idioma. Por fim, o cliente fecha todas as conexões que foram abertas
                e pede para o usuário digitar outra expressão matemática.
            </p>
            <p>
                Caso tudo ocorra com sucesso, o select irá interpretar a mensagem recebida e o cliente irá imprimir o resultado;
                se for um número, mostrar ele; se for uma mensagem de erro, transforma em texto e mostra, como descrito acima.
                Feito tudo isso, o usuário pode digitar outra expressão, que o programa realizará as mesmas etapas de novo.

                Para finalizar a execução do programa, basta usar o atalho Ctrl+C.
            </p>

            <h3>Arquivos:</h3>
            <h4>server.txt</h4>
            <p>
                Esse arquivo possui uma lista com todos os servidores que fazem parte da rede e estão interessados em participar
                da calculadora. Como estamos fazendo um Multicast e não um Broadcast, essa lista é o grupo de servidores.
            </p>

            <h4>pyparsing.py e pyparsingtest.py</h4>
            <p>
                pyparsing.py é a biblioteca para converter texto em gramática.
                <br>pyparsingtest.py é um grupo de funções para converter a gramática, produzida pelo pyparsing, em expressões
                matemáticas e resolver elas.

                Exemplo:
                <br>
                <p style="font-size: smaller"> 9 + 3 + 6 = ['9', '+', '3', '+', '6'] = ['9', '3', '+', '6', '+'] => 18.0</p>
                <p style="font-size: smaller">9 + 3 / 11 = ['9', '+', '3', '/', '11'] = ['9', '3', '11', '/', '+'] => = 9.27272727273</p>
            <p style="font-size: smaller">PI * PI / 10 = ['PI', 'PI', '*', '10', '/'] = ['PI', '*', 'PI', '/', '10'] => 0.986960440109</p>
            </p>
            <h4>client.py</h4>
            <p>

                Vou arrumar o restante amanhã.
            </p>
            <h4> server.py</h4>
            <p>

            </p>

            <h3>Conclusão:</h3>
            <p>

            </p><br>
            <pre>
> 2 clientes:
- Mensagem
- Mensagem

> 6 clientes:
- Mensagem
- Mensagem
- Mensagem
- Mensagem

> 18 clientes:
- Mensagem
- Mensagem
- Mensagem
- Mensagem

> 54 clientes:
- Mensagem
- Mensagem
- Mensagem
- Mensagem

> 162 clientes:
- Mensagem
- Mensagem
- Mensagem
- Mensagem
		</pre>
            <h3>Exemplo de modo de uso:</h3>
            <h6>
                    * Deve-se usar python3 para execução do trabalho;
                    <br>
                    * Para terminar a execução do servidor é necessária a interrupção Ctrl+C
            </h6>
            <br>
        </main>
    </section>
</body>
</html>